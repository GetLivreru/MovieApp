<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <title>KinoBoom</title>
</head>
<body class="bg-gray-900">
    <nav class="flex items-center justify-between p-6">
        <div class="flex items-center space-x-4">
            <a class="text-white" href="/">Home</a>
            <a class="text-white" href="/news">News</a>
            <a class="text-white" href="/tmdb">TMDB</a>
        </div>
        <div class="flex items-center space-x-4">
            <select id="language" class="rounded">
                <option value="en">EN</option>
                <option value="ru">RU</option>
                <option value="kz">KZ</option>
            </select>
            <% if (!user) { %>
                <a class="text-white" href="/login">Login</a>
                <a class="text-white" href="/signup">Sign Up</a>
            <% } else { %>
                <% if (user.is_admin) { %>
                    <a class="nav-link <%= activePage === 'home' ? 'active text-primary fw-semibold' : '' %>" href="/admin/items">Movies</a>
                            <a class="nav-link <%= activePage === 'home' ? 'active text-primary fw-semibold' : '' %>" href="/admin">Users</a>
                            <a class="nav-link <%= activePage === 'home' ? 'active text-primary fw-semibold' : '' %>" href="/">Home</a>
                <% } %>
                <a class="nav-link <%= activePage === 'tmdb' ? 'active text-primary fw-semibold' : '' %>" href=""><%= user.username %></a>
                <a class="nav-link <%= activePage === 'tmdb' ? 'active text-primary fw-semibold' : '' %>" href="/logout">Logout</a>
            <% } %>
        </div>
    </nav>

    <div class="mx-auto px-4">
        <div class="text-4xl text-gray-900" id="slogan-text">Movie Time</div>
        <div class="grid grid-cols-3 gap-4 mt-5">
            <% items.forEach(function(item, index) { %>
                <div class="mb-4">
                    <div class="h-full rounded overflow-hidden">
                        <div id="carouselExampleControls<%= index %>" class="carousel slide" data-bs-ride="carousel">
                            <div class="carousel-inner">
                                <% item.pictures.forEach(function(picture, picIndex) { %>
                                    <div class="carousel-item <%= picIndex === 0 ? 'active' : '' %>">
                                        <img src="<%= picture %>" class="d-block w-full rounded" alt="...">
                                    </div>
                                <% }); %>
                            </div>
                        </div>
                        <div class="p-4" id="aircraft-<%= index %>">
                            <h5 class="text-xl font-bold"><%= item.names.en %></h5>
                            <p class="mt-2"><%= item.descriptions.en %></p>
                            <p class="mt-2">Genre: <%= item.genre %></p>
                            <p class="mt-2">Director: <%= item.director %></p>
                            <p class="mt-2">Budget: <%= item.budget %></p>
                        </div>
                    </div>
                </div>
            <% }); %>
        </div>
    </div>
        
    <section class="mt-5">
        <footer class="text-center text-white bg-primary">
            <div class="text-center py-3 bg-opacity-40 bg-purple-500">
                © 2024 Copyright:
                <a class="text-white" href="/signup">Adilet Kaiyrbekov</a>
            </div>
        </footer>
    </section>

    <% if (error) { %>
        <script>
            Swal.fire({
                title: "An error occured!",
                text: "City was not found.",
                icon: "error"
            });
        </script>
    <% } %>

    <script>
        var items = <%- JSON.stringify(items) %>;
    
        document.addEventListener('DOMContentLoaded', function() {
            var languageSelect = document.getElementById('language');
    
            if (languageSelect) {
                languageSelect.addEventListener('change', function() {
                    var selectedLanguage = this.value;
    
                    items.forEach(function(item, index) {
                        var aircraft = document.getElementById('aircraft-' + index);
                        if (aircraft) {
                            aircraft.querySelector('.text-xl').textContent = item.names[selectedLanguage];
                            aircraft.querySelector('p').textContent = item.descriptions[selectedLanguage];
                        }
                    });
    
                    switch(selectedLanguage) {
                        case 'ru': {
                            document.getElementById('slogan-text').textContent = 'Время Фильма'; break;
                        }
                        case 'en': {
                            document.getElementById('slogan-text').textContent = 'Moive Time'; break;
                        }
                        case 'kz': {
                            document.getElementById('slogan-text').textContent = 'Фильм уакыты'; break;
                        }
                    }
                });
            }
        });

        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.carousel').forEach(function(carousel) {
                var currentIndex = 0;
                var items = carousel.querySelectorAll('.carousel-item');
                var totalItems = items.length;

                function nextSlide() {
                    currentIndex = (currentIndex + 1) % totalItems;
                    updateCarousel();
                }

                function prevSlide() {
                    currentIndex = (currentIndex - 1 + totalItems) % totalItems;
                    updateCarousel();
                }

                function updateCarousel() {
                    items.forEach(function(item, index) {
                        if (index === currentIndex) {
                            item.classList.add('active');
                        } else {
                            item.classList.remove('active');
                        }
                    });
                }

                carousel.querySelector('.carousel-control-prev').addEventListener('click', prevSlide);
                carousel.querySelector('.carousel-control-next').addEventListener('click', nextSlide);
            });
        });
    </script>
</body>
</html>
